#!/bin/sh

# This script is an imitation of locate from the mlocate package.
# It runs a grep command on a text file generated by the updatedb script.
# Any flags passed to this script will be passed to grep.
#
# ADDITIONAL FLAGS (must be passed first, cannot be grouped):
#   -h
#   Return only results from the user's home directory
#
#   -H
#   Return only results from outside the user's home directory

db=~/.cache/updatedb

if [ ! -f "$db" ]; then
    printf "Database doesn't exist. Generate now? [Y/n] " >&2
    read -r ans
    [ -z "$ans" ] || [ "$ans" = Y ] || [ "$ans" = y ] && { updatedb || exit 1; }
fi

home=
case "$1" in
    -h) home=1 ; shift ;;
    -H) home=0 ; shift ;;
esac

if [ -z "$home" ]; then
    grep -i --color=auto -a "$@" "$db"
elif [ "$home" = 1 ]; then
    grep -i -a "^$HOME" "$db" | grep --color=auto -a "$@"
elif [ "$home" = 0 ]; then
    grep -av "^$HOME" "$db" | grep --color=auto -a "$@"
fi
